[DEFAULT]
nodes = micklethefickle beatapostapita cloudserver1 cloudserver2 cloudserver3
orchestrate = ha
topology = failover

[container#1]
type = docker
image = ghcr.io/firecrawl/firecrawl
name = firecrawl
hostname = api
run_args = --network {env.STACK_NAME}_backend --add-host "host.docker.internal:host-gateway" -e REDIS_URL="{env.FIRECRAWL_REDIS_URL}" -e REDIS_RATE_LIMIT_URL="{env.FIRECRAWL_REDIS_RATE_LIMIT_URL}" -e PLAYWRIGHT_MICROSERVICE_URL="{env.PLAYWRIGHT_MICROSERVICE_URL}" -e NUQ_DATABASE_URL="{env.NUQ_DATABASE_URL}" -e NUQ_RABBITMQ_URL="{env.NUQ_RABBITMQ_URL}" -e EXTRACT_WORKER_PORT="{env.EXTRACT_WORKER_PORT}" -e USE_DB_AUTHENTICATION="{env.USE_DB_AUTHENTICATION}" -e OPENAI_API_KEY_FILE="/run/secrets/openai-api-key" -e OPENAI_BASE_URL="{env.OPENAI_BASE_URL}" -e MODEL_NAME="{env.MODEL_NAME}" -e MODEL_EMBEDDING_NAME="{env.MODEL_EMBEDDING_NAME}" -e OLLAMA_BASE_URL="{env.OLLAMA_BASE_URL}" -e SLACK_WEBHOOK_URL="{env.SLACK_WEBHOOK_URL}" -e BULL_AUTH_KEY_FILE="/run/secrets/firecrawl-api-key" -e TEST_API_KEY_FILE="/run/secrets/firecrawl-api-key" -e POSTHOG_API_KEY="{env.POSTHOG_API_KEY}" -e POSTHOG_HOST="{env.POSTHOG_HOST}" -e SUPABASE_ANON_TOKEN="{env.SUPABASE_ANON_TOKEN}" -e SUPABASE_URL="{env.SUPABASE_URL}" -e SUPABASE_SERVICE_TOKEN="{env.SUPABASE_SERVICE_TOKEN}" -e SELF_HOSTED_WEBHOOK_URL="{env.SELF_HOSTED_WEBHOOK_URL}" -e SERPER_API_KEY="{env.SERPER_API_KEY}" -e SEARCHAPI_API_KEY="{env.SEARCHAPI_API_KEY}" -e SEARXNG_ENDPOINT="{env.SEARXNG_ENDPOINT}" -e HOST="{env.HOST}" -e PORT="{env.PORT}" -e WORKER_PORT="{env.WORKER_PORT}" -e ENV="{env.ENV}" -v {env.SECRETS_PATH}/openai-api-key.txt:/run/secrets/openai-api-key:ro -v {env.SECRETS_PATH}/firecrawl-api-key.txt:/run/secrets/firecrawl-api-key:ro -l "traefik.enable=true" -l "homepage.group=AI" -l "homepage.name=Firecrawl" -l "homepage.icon=firecrawl.png" -l "homepage.href=https://firecrawl.{env.DOMAIN}" -l "homepage.description=Firecrawl is a tool for crawling and indexing web pages." -l "traefik.http.routers.firecrawl.rule=Host(`firecrawl-api.{env.DOMAIN}`) || Host(`firecrawl-api.{env.TS_HOSTNAME}.{env.DOMAIN}`)" -l "traefik.http.services.firecrawl.loadbalancer.server.port={env.PORT}" -l "deunhealth.restart.on.unhealthy=true" -l "kuma.firecrawl.http.name=firecrawl.{env.TS_HOSTNAME}.{env.DOMAIN}" -l "kuma.firecrawl.http.url=https://firecrawl.{env.DOMAIN}" -l "kuma.firecrawl.http.interval=60" --mem-reservation 4G --cpus 4.0 --restart always
command = node dist/src/harness.js --start-docker

[env]
DOMAIN = bolabaden.org
TS_HOSTNAME = beatapostapita
STACK_NAME = my-media-stack
SECRETS_PATH = /home/ubuntu/my-media-stack/secrets
FIRECRAWL_REDIS_URL = redis://redis:6379
FIRECRAWL_REDIS_RATE_LIMIT_URL = redis://redis:6379
PLAYWRIGHT_MICROSERVICE_URL = http://playwright-service:3000/scrape
NUQ_DATABASE_URL = postgres://postgres:postgres@nuq-postgres:5432/postgres
NUQ_RABBITMQ_URL = amqp://rabbitmq:rabbitmq@rabbitmq:5672
EXTRACT_WORKER_PORT = 3004
USE_DB_AUTHENTICATION = false
OPENAI_BASE_URL = 
MODEL_NAME = 
MODEL_EMBEDDING_NAME = 
OLLAMA_BASE_URL = 
SLACK_WEBHOOK_URL = 
POSTHOG_API_KEY = 
POSTHOG_HOST = 
SUPABASE_ANON_TOKEN = 
SUPABASE_URL = 
SUPABASE_SERVICE_TOKEN = 
SELF_HOSTED_WEBHOOK_URL = 
SERPER_API_KEY = 
SEARCHAPI_API_KEY = 
SEARXNG_ENDPOINT = https://searxng.bolabaden.org
HOST = 0.0.0.0
PORT = 3002
WORKER_PORT = 3005
ENV = local

